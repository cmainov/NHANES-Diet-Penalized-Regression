dat.sub <- dat %>%
dplyr::filter(Diet.ext.ind.reg==1) %>% # use data inclusions/exclusions subset for this section
dplyr::mutate(wts.norm = WTDR18YR / mean(WTDR18YR)) # create normalized weights
dat.sub$PrimaryCAGroup<-droplevels(dat.sub$PrimaryCAGroup) # drop levels with zero observations  (NMSC)
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median')
dat.sub <- dat %>%
dplyr::filter(Diet.ext.ind.reg==1) %>% # use data inclusions/exclusions subset for this section
dplyr::mutate(wts.norm = WTDR18YR / mean(WTDR18YR)) # create normalized weights
dat.sub$PrimaryCAGroup<-droplevels(dat.sub$PrimaryCAGroup) # drop levels with zero observations  (NMSC)
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median')
df=dat.sub
x='FS_ENet'
y='BinFoodSecHH'
knots=5
covariates=covars.logit
wts='wts.norm'
referent='median'
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=get(wts),
normwt = T)
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=c(0.34,0.8),
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs(x=pattern.labels[i], y='Odds Ratio (Food Insecure)')
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median'){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=get(wts),
normwt = T)
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=c(0.34,0.8),
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs(y='Odds Ratio (Food Insecure)')
}
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median')
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score')
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=get(wts),
normwt = T)
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=c(0.34,0.8),
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs( x=xlab, y=ylab )
}
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score')
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=get(wts),
normwt = T)
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+')),na.action='na.exclude'),
data=df,
weights=get(wts),
normwt = T)
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+')),na.action='na.exclude'),
data=df,
weights=WTDR18YR,
normwt = T)
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+')),na.action='na.exclude'),
data=df,
weights=WTDR18YR)
glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))
glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+')),na.action='na.exclude'),
data=df)
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=c(0.34,0.8),
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs( x=xlab, y=ylab )
}
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score')
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+')),na.action='na.exclude'),
data=df,
weights=WTDR18YR,
normwt = T)
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=c(0.34,0.8),
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs( x=xlab, y=ylab )
}
dd <- rms::datadist(df)
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab){
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=WTDR18YR,
normwt = T)
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=c(0.34,0.8),
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs( x=xlab, y=ylab )
}
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score')
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=WTDR18YR,
normwt = T)
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=c(0.34,0.8),
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs( x=xlab, y=ylab )
}
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=WTDR18YR,
normwt = T)
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=c(0.34,0.8),
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs( x=xlab, y=ylab )
}
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score')
?lrm
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=get(wts),
normwt = T) # normalize weights for survey data
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=c(0.34,0.8),
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs( x=xlab, y=ylab )
}
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score')
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score')
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab,
legend.pos){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=get(wts),
normwt = T) # normalize weights for survey data
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Reference (HR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=legend.pos,
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs( x=xlab, y=ylab )
}
logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='wts.norm', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score',
legend.pos=c(0.34,0.8))
pattern.labels <- paste0(c("Age", "SNAP", "Household Size", "Modified Western", "Prudent"),"Pattern Score")
pattern.labels <- paste0(c("Age", "SNAP", "Household Size", "Modified Western", "Prudent")," Pattern Score")
p <- list() # initialize list to store plots
for (i in 1:length(patterns)){
if (i==1){
p[[i]] <- logit_splines(df=dat.sub, x='FS_ENet', y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score',
legend.pos=c(0.34,0.8))
}
else {
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab="Odds Ratio (Food Insecure)", xlab='FI Pattern Score',
legend.pos= "none")
}
}
p <- list() # initialize list to store plots
for (i in 1:length(patterns)){
if (i==1){
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab="Odds Ratio (Food Insecure)", xlab=pattern.labels[i],
legend.pos=c(0.34,0.8))
}
else if (i==4){
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab="Odds Ratio (Food Insecure)", xlab=pattern.labels[i],
legend.pos= "none")
}
else {
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab=NULL, xlab=pattern.labels[i],
legend.pos= "none")
}
}
patterns <- c("FS_ENet", 'Age_ENet','FdAs_ENet','HHS_ENet','PC1','PC2')
pattern.labels <- paste0(c("FI", "Age", "SNAP", "Household Size", "Modified Western", "Prudent")," Pattern Score")
p <- list() # initialize list to store plots
for (i in 1:length(patterns)){
if (i==1){
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab="Odds Ratio (Food Insecure)", xlab=pattern.labels[i],
legend.pos=c(0.34,0.8))
}
else if (i==4){
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab="Odds Ratio (Food Insecure)", xlab=pattern.labels[i],
legend.pos= "none")
}
else {
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab=NULL, xlab=pattern.labels[i],
legend.pos= "none")
}
}
warnings()
do.call("ggarrange", p)
library( ggpubr )
do.call("ggarrange", p)
logit_splines <- function(df, x, y, knots, covariates, wts, referent='median', xlab, ylab,
legend.pos){
df$x<-as.numeric(eval(parse(text=paste0('df$',x))))
dd <- rms::datadist(df)
dd$limits$x[2] <- unique(df[GenKern::nearest(df$x,eval(parse(text=paste0(referent,"( ","df$x,na.rm=T)")))),'x'] )
options(datadist = "dd")
# Fit logit model with spline term
modelspline<-rms::lrm(formula(glue::glue('{y} ~ rms::rcs( x, {knots} ) + ',
paste0(covariates,collapse='+'))),
data=df,
weights=get(wts),
normwt = T) # normalize weights for survey data
pdata1 <- rms::Predict(modelspline,
x,
ref.zero = TRUE,
fun = exp)
newdf<-data.frame(pdata1)
newdf$relative<-1
newdf$all<-'Referent (OR=1)'
newdf$ci<-'95% Confidence Bounds'
ggplot2::ggplot(data=newdf,mapping=aes(x=x,y=yhat))+
geom_line(size=0.8)+
geom_ribbon(aes(ymin=lower, ymax=upper,col=ci,fill=ci), alpha=0.2)+
theme_classic()+
geom_line(aes(y=relative, x=x,linetype=all))+
scale_linetype_manual(values=c('dashed'))+
theme(legend.position=legend.pos,
text=element_text(family='Avenir'),
legend.title=element_blank(),
legend.spacing.y =unit(0.01,'cm'),
legend.text = element_text(size=8))+
coord_cartesian(ylim=c(0,max=(max(newdf$yhat)*3)))+
labs( x=xlab, y=ylab )
}
patterns <- c("FS_ENet", 'Age_ENet','FdAs_ENet','HHS_ENet','PC1','PC2')
pattern.labels <- paste0(c("FI", "Age", "SNAP", "Household Size", "Modified Western", "Prudent")," Pattern Score")
p <- list() # initialize list to store plots
for (i in 1:length(patterns)){
if (i==1){
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab="Odds Ratio (Food Insecure)", xlab=pattern.labels[i],
legend.pos=c(0.34,0.8))
}
else if (i==4){
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab="Odds Ratio (Food Insecure)", xlab=pattern.labels[i],
legend.pos= "none")
}
else {
p[[i]] <- logit_splines(df=dat.sub, x=patterns[i], y='BinFoodSecHH', knots=5, covariates=covars.logit,
wts='WTDR18YR', referent='median', ylab=NULL, xlab=pattern.labels[i],
legend.pos= "none")
}
}
do.call("ggarrange", p)
#Save
setwd( paste0(wd,"Manuscript/Figures") )
do.call("ggarrange", p)
ggsave("logit-splines.jpeg",width = 30, height = 20, units = "cm")
table(dat$PrimaryCAGroup)
