mutate( CALC = ifelse( DRDINT == 2, ( DR1TCALC+DR2TCALC )/2,
ifelse( DRDINT == 1 & is.na( DR1TCALC ) == FALSE, DR1TCALC,
ifelse( DRDINT == 1 & is.na( DR2TCALC ) == FALSE, DR2TCALC, NA ) ) ) )%>%
mutate( IRON = ifelse( DRDINT == 2, ( DR1TIRON+DR2TIRON )/2,
ifelse( DRDINT == 1 & is.na( DR1TIRON ) == FALSE, DR1TIRON,
ifelse( DRDINT == 1 & is.na( DR2TIRON ) == FALSE, DR2TIRON, NA ) ) ) )%>%
mutate( SODIUM = ifelse( DRDINT == 2, ( DR1TSODI+DR2TSODI )/2,
ifelse( DRDINT == 1 & is.na( DR1TSODI ) == FALSE, DR1TSODI,
ifelse( DRDINT == 1 & is.na( DR2TSODI ) == FALSE, DR2TSODI, NA ) ) ) )%>%
mutate( `PMUFA:SFA` = ( MFAT+PFAT )/SFAT )%>%
mutate( WTDR4YR = NA )%>%  ##weights for multiple cycles require 4 yr weights for years 99-01
select( SEQN, WTDRD1, WTDR2D, KCAL, PROT, CARB, TFAT, SFAT, MFAT, PFAT, CHOL, FIBE, ALCO, VITC,
ZINC, MAGN, B1, B2, FOLA, B5, B6, SELE, CALC, IRON, SODIUM, WTDR4YR, `PMUFA:SFA` )
#2015-2016 nutrient
nutrdat15 <- merge( nutrdat15d1[c( "SEQN", "DRDINT", "DR1TKCAL", "DR1TPROT", "DR1TCARB", "DR1TTFAT", "DR1TSFAT",
"DR1TMFAT", "DR1TPFAT", "DR1TCHOL", "DR1TFIBE", 'DR1TALCO', 'DR1TVC', 'DR1TZINC', 'DR1TMAGN',
'DR1TVB1', 'DR1TVB2', 'DR1TFOLA', 'DR1TNIAC', 'DR1TVB6', 'DR1TSELE', 'DR1TCALC', 'DR1TIRON', 'DR1TSODI', 'WTDRD1', 'WTDR2D' )],
nutrdat15d2[c( "SEQN", "DRDINT", "DR2TKCAL", "DR2TPROT", "DR2TCARB", "DR2TTFAT", "DR2TSFAT",
"DR2TMFAT", "DR2TPFAT", "DR2TCHOL", "DR2TFIBE", 'DR2TALCO', 'DR2TVC', 'DR2TZINC', 'DR2TMAGN',
'DR2TVB1', 'DR2TVB2', 'DR2TFOLA', 'DR2TNIAC', 'DR2TVB6', 'DR2TSELE', 'DR2TCALC', 'DR2TIRON', 'DR2TSODI', 'WTDR2D' )] )
nutrdat15 <- nutrdat15%>%
mutate( KCAL = ifelse( DRDINT == 2, ( DR1TKCAL+DR2TKCAL )/2,
ifelse( DRDINT == 1 & is.na( DR1TKCAL ) == FALSE, DR1TKCAL,
ifelse( DRDINT == 1 & is.na( DR2TKCAL ) == FALSE, DR2TKCAL, NA ) ) ) )%>%
mutate( PROT = ifelse( DRDINT == 2, ( DR1TPROT+DR2TPROT )/2,
ifelse( DRDINT == 1 & is.na( DR1TPROT ) == FALSE, DR1TPROT,
ifelse( DRDINT == 1 & is.na( DR2TPROT ) == FALSE, DR2TPROT, NA ) ) ) )%>%
mutate( CARB = ifelse( DRDINT == 2, ( DR1TCARB+DR2TCARB )/2,
ifelse( DRDINT == 1 & is.na( DR1TCARB ) == FALSE, DR1TCARB,
ifelse( DRDINT == 1 & is.na( DR2TCARB ) == FALSE, DR2TCARB, NA ) ) ) )%>%
mutate( TFAT = ifelse( DRDINT == 2, ( DR1TTFAT+DR2TTFAT )/2,
ifelse( DRDINT == 1 & is.na( DR1TTFAT ) == FALSE, DR1TTFAT,
ifelse( DRDINT == 1 & is.na( DR2TTFAT ) == FALSE, DR2TTFAT, NA ) ) ) )%>%
mutate( SFAT = ifelse( DRDINT == 2, ( DR1TSFAT+DR2TSFAT )/2,
ifelse( DRDINT == 1 & is.na( DR1TSFAT ) == FALSE, DR1TSFAT,
ifelse( DRDINT == 1 & is.na( DR2TSFAT ) == FALSE, DR2TSFAT, NA ) ) ) )%>%
mutate( MFAT = ifelse( DRDINT == 2, ( DR1TMFAT+DR2TMFAT )/2,
ifelse( DRDINT == 1 & is.na( DR1TMFAT ) == FALSE, DR1TMFAT,
ifelse( DRDINT == 1 & is.na( DR2TMFAT ) == FALSE, DR2TMFAT, NA ) ) ) )%>%
mutate( PFAT = ifelse( DRDINT == 2, ( DR1TPFAT+DR2TPFAT )/2,
ifelse( DRDINT == 1 & is.na( DR1TPFAT ) == FALSE, DR1TPFAT,
ifelse( DRDINT == 1 & is.na( DR2TPFAT ) == FALSE, DR2TPFAT, NA ) ) ) )%>%
mutate( CHOL = ifelse( DRDINT == 2, ( DR1TCHOL+DR2TCHOL )/2,
ifelse( DRDINT == 1 & is.na( DR1TCHOL ) == FALSE, DR1TCHOL,
ifelse( DRDINT == 1 & is.na( DR2TCHOL ) == FALSE, DR2TCHOL, NA ) ) ) )%>%
mutate( FIBE = ifelse( DRDINT == 2, ( DR1TFIBE+DR2TFIBE )/2,
ifelse( DRDINT == 1 & is.na( DR1TFIBE ) == FALSE, DR1TFIBE,
ifelse( DRDINT == 1 & is.na( DR2TFIBE ) == FALSE, DR2TFIBE, NA ) ) ) )%>%
mutate( ALCO = ifelse( DRDINT == 2, ( DR1TALCO+DR2TALCO )/2,
ifelse( DRDINT == 1 & is.na( DR1TALCO ) == FALSE, DR1TALCO,
ifelse( DRDINT == 1 & is.na( DR2TALCO ) == FALSE, DR2TALCO, NA ) ) ) )%>%
mutate( VITC = ifelse( DRDINT == 2, ( DR1TVC+DR2TVC )/2,
ifelse( DRDINT == 1 & is.na( DR1TVC ) == FALSE, DR1TVC,
ifelse( DRDINT == 1 & is.na( DR2TVC ) == FALSE, DR2TVC, NA ) ) ) )%>%
mutate( ZINC = ifelse( DRDINT == 2, ( DR1TZINC+DR2TZINC )/2,
ifelse( DRDINT == 1 & is.na( DR1TZINC ) == FALSE, DR1TZINC,
ifelse( DRDINT == 1 & is.na( DR2TZINC ) == FALSE, DR2TZINC, NA ) ) ) )%>%
mutate( MAGN = ifelse( DRDINT == 2, ( DR1TMAGN+DR2TMAGN )/2,
ifelse( DRDINT == 1 & is.na( DR1TMAGN ) == FALSE, DR1TMAGN,
ifelse( DRDINT == 1 & is.na( DR2TMAGN ) == FALSE, DR2TMAGN, NA ) ) ) )%>%
mutate( B1 = ifelse( DRDINT == 2, ( DR1TVB1+DR2TVB1 )/2,
ifelse( DRDINT == 1 & is.na( DR1TVB1 ) == FALSE, DR1TVB1,
ifelse( DRDINT == 1 & is.na( DR2TVB1 ) == FALSE, DR2TVB1, NA ) ) ) )%>%
mutate( B2 = ifelse( DRDINT == 2, ( DR1TVB2+DR2TVB2 )/2,
ifelse( DRDINT == 1 & is.na( DR1TVB2 ) == FALSE, DR1TVB2,
ifelse( DRDINT == 1 & is.na( DR2TVB2 ) == FALSE, DR2TVB2, NA ) ) ) )%>%
mutate( FOLA = ifelse( DRDINT == 2, ( DR1TFOLA+DR2TFOLA )/2,
ifelse( DRDINT == 1 & is.na( DR1TFOLA ) == FALSE, DR1TFOLA,
ifelse( DRDINT == 1 & is.na( DR2TFOLA ) == FALSE, DR2TFOLA, NA ) ) ) )%>%
mutate( B5 = ifelse( DRDINT == 2, ( DR1TNIAC+DR2TNIAC )/2,
ifelse( DRDINT == 1 & is.na( DR1TNIAC ) == FALSE, DR1TNIAC,
ifelse( DRDINT == 1 & is.na( DR2TNIAC ) == FALSE, DR2TNIAC, NA ) ) ) )%>%
mutate( B6 = ifelse( DRDINT == 2, ( DR1TVB6+DR2TVB6 )/2,
ifelse( DRDINT == 1 & is.na( DR1TVB6 ) == FALSE, DR1TVB6,
ifelse( DRDINT == 1 & is.na( DR2TVB6 ) == FALSE, DR2TVB6, NA ) ) ) )%>%
mutate( SELE = ifelse( DRDINT == 2, ( DR1TSELE+DR2TSELE )/2,
ifelse( DRDINT == 1 & is.na( DR1TSELE ) == FALSE, DR1TSELE,
ifelse( DRDINT == 1 & is.na( DR2TSELE ) == FALSE, DR2TSELE, NA ) ) ) )%>%
mutate( CALC = ifelse( DRDINT == 2, ( DR1TCALC+DR2TCALC )/2,
ifelse( DRDINT == 1 & is.na( DR1TCALC ) == FALSE, DR1TCALC,
ifelse( DRDINT == 1 & is.na( DR2TCALC ) == FALSE, DR2TCALC, NA ) ) ) )%>%
mutate( IRON = ifelse( DRDINT == 2, ( DR1TIRON+DR2TIRON )/2,
ifelse( DRDINT == 1 & is.na( DR1TIRON ) == FALSE, DR1TIRON,
ifelse( DRDINT == 1 & is.na( DR2TIRON ) == FALSE, DR2TIRON, NA ) ) ) )%>%
mutate( SODIUM = ifelse( DRDINT == 2, ( DR1TSODI+DR2TSODI )/2,
ifelse( DRDINT == 1 & is.na( DR1TSODI ) == FALSE, DR1TSODI,
ifelse( DRDINT == 1 & is.na( DR2TSODI ) == FALSE, DR2TSODI, NA ) ) ) )%>%
mutate( `PMUFA:SFA` = ( MFAT+PFAT )/SFAT )%>%
mutate( WTDR4YR = NA )%>%  ##weights for multiple cycles require 4 yr weights for years 99-01
select( SEQN, WTDRD1, WTDR2D, KCAL, PROT, CARB, TFAT, SFAT, MFAT, PFAT, CHOL, FIBE, ALCO, VITC,
ZINC, MAGN, B1, B2, FOLA, B5, B6, SELE, CALC, IRON, SODIUM, WTDR4YR, `PMUFA:SFA` )
#2017-2018 nutrient
nutrdat17 <- merge( nutrdat17d1[c( "SEQN", "DRDINT", "DR1TKCAL", "DR1TPROT", "DR1TCARB", "DR1TTFAT", "DR1TSFAT",
"DR1TMFAT", "DR1TPFAT", "DR1TCHOL", "DR1TFIBE", 'DR1TALCO', 'DR1TVC', 'DR1TZINC', 'DR1TMAGN',
'DR1TVB1', 'DR1TVB2', 'DR1TFOLA', 'DR1TNIAC', 'DR1TVB6', 'DR1TSELE', 'DR1TCALC', 'DR1TIRON', 'DR1TSODI', 'WTDRD1', 'WTDR2D' )],
nutrdat17d2[c( "SEQN", "DRDINT", "DR2TKCAL", "DR2TPROT", "DR2TCARB", "DR2TTFAT", "DR2TSFAT",
"DR2TMFAT", "DR2TPFAT", "DR2TCHOL", "DR2TFIBE", 'DR2TALCO', 'DR2TVC', 'DR2TZINC', 'DR2TMAGN',
'DR2TVB1', 'DR2TVB2', 'DR2TFOLA', 'DR2TNIAC', 'DR2TVB6', 'DR2TSELE', 'DR2TCALC', 'DR2TIRON', 'DR2TSODI', 'WTDR2D' )] )
nutrdat17 <- nutrdat17%>%
mutate( KCAL = ifelse( DRDINT == 2, ( DR1TKCAL+DR2TKCAL )/2,
ifelse( DRDINT == 1 & is.na( DR1TKCAL ) == FALSE, DR1TKCAL,
ifelse( DRDINT == 1 & is.na( DR2TKCAL ) == FALSE, DR2TKCAL, NA ) ) ) )%>%
mutate( PROT = ifelse( DRDINT == 2, ( DR1TPROT+DR2TPROT )/2,
ifelse( DRDINT == 1 & is.na( DR1TPROT ) == FALSE, DR1TPROT,
ifelse( DRDINT == 1 & is.na( DR2TPROT ) == FALSE, DR2TPROT, NA ) ) ) )%>%
mutate( CARB = ifelse( DRDINT == 2, ( DR1TCARB+DR2TCARB )/2,
ifelse( DRDINT == 1 & is.na( DR1TCARB ) == FALSE, DR1TCARB,
ifelse( DRDINT == 1 & is.na( DR2TCARB ) == FALSE, DR2TCARB, NA ) ) ) )%>%
mutate( TFAT = ifelse( DRDINT == 2, ( DR1TTFAT+DR2TTFAT )/2,
ifelse( DRDINT == 1 & is.na( DR1TTFAT ) == FALSE, DR1TTFAT,
ifelse( DRDINT == 1 & is.na( DR2TTFAT ) == FALSE, DR2TTFAT, NA ) ) ) )%>%
mutate( SFAT = ifelse( DRDINT == 2, ( DR1TSFAT+DR2TSFAT )/2,
ifelse( DRDINT == 1 & is.na( DR1TSFAT ) == FALSE, DR1TSFAT,
ifelse( DRDINT == 1 & is.na( DR2TSFAT ) == FALSE, DR2TSFAT, NA ) ) ) )%>%
mutate( MFAT = ifelse( DRDINT == 2, ( DR1TMFAT+DR2TMFAT )/2,
ifelse( DRDINT == 1 & is.na( DR1TMFAT ) == FALSE, DR1TMFAT,
ifelse( DRDINT == 1 & is.na( DR2TMFAT ) == FALSE, DR2TMFAT, NA ) ) ) )%>%
mutate( PFAT = ifelse( DRDINT == 2, ( DR1TPFAT+DR2TPFAT )/2,
ifelse( DRDINT == 1 & is.na( DR1TPFAT ) == FALSE, DR1TPFAT,
ifelse( DRDINT == 1 & is.na( DR2TPFAT ) == FALSE, DR2TPFAT, NA ) ) ) )%>%
mutate( CHOL = ifelse( DRDINT == 2, ( DR1TCHOL+DR2TCHOL )/2,
ifelse( DRDINT == 1 & is.na( DR1TCHOL ) == FALSE, DR1TCHOL,
ifelse( DRDINT == 1 & is.na( DR2TCHOL ) == FALSE, DR2TCHOL, NA ) ) ) )%>%
mutate( FIBE = ifelse( DRDINT == 2, ( DR1TFIBE+DR2TFIBE )/2,
ifelse( DRDINT == 1 & is.na( DR1TFIBE ) == FALSE, DR1TFIBE,
ifelse( DRDINT == 1 & is.na( DR2TFIBE ) == FALSE, DR2TFIBE, NA ) ) ) )%>%
mutate( ALCO = ifelse( DRDINT == 2, ( DR1TALCO+DR2TALCO )/2,
ifelse( DRDINT == 1 & is.na( DR1TALCO ) == FALSE, DR1TALCO,
ifelse( DRDINT == 1 & is.na( DR2TALCO ) == FALSE, DR2TALCO, NA ) ) ) )%>%
mutate( VITC = ifelse( DRDINT == 2, ( DR1TVC+DR2TVC )/2,
ifelse( DRDINT == 1 & is.na( DR1TVC ) == FALSE, DR1TVC,
ifelse( DRDINT == 1 & is.na( DR2TVC ) == FALSE, DR2TVC, NA ) ) ) )%>%
mutate( ZINC = ifelse( DRDINT == 2, ( DR1TZINC+DR2TZINC )/2,
ifelse( DRDINT == 1 & is.na( DR1TZINC ) == FALSE, DR1TZINC,
ifelse( DRDINT == 1 & is.na( DR2TZINC ) == FALSE, DR2TZINC, NA ) ) ) )%>%
mutate( MAGN = ifelse( DRDINT == 2, ( DR1TMAGN+DR2TMAGN )/2,
ifelse( DRDINT == 1 & is.na( DR1TMAGN ) == FALSE, DR1TMAGN,
ifelse( DRDINT == 1 & is.na( DR2TMAGN ) == FALSE, DR2TMAGN, NA ) ) ) )%>%
mutate( B1 = ifelse( DRDINT == 2, ( DR1TVB1+DR2TVB1 )/2,
ifelse( DRDINT == 1 & is.na( DR1TVB1 ) == FALSE, DR1TVB1,
ifelse( DRDINT == 1 & is.na( DR2TVB1 ) == FALSE, DR2TVB1, NA ) ) ) )%>%
mutate( B2 = ifelse( DRDINT == 2, ( DR1TVB2+DR2TVB2 )/2,
ifelse( DRDINT == 1 & is.na( DR1TVB2 ) == FALSE, DR1TVB2,
ifelse( DRDINT == 1 & is.na( DR2TVB2 ) == FALSE, DR2TVB2, NA ) ) ) )%>%
mutate( FOLA = ifelse( DRDINT == 2, ( DR1TFOLA+DR2TFOLA )/2,
ifelse( DRDINT == 1 & is.na( DR1TFOLA ) == FALSE, DR1TFOLA,
ifelse( DRDINT == 1 & is.na( DR2TFOLA ) == FALSE, DR2TFOLA, NA ) ) ) )%>%
mutate( B5 = ifelse( DRDINT == 2, ( DR1TNIAC+DR2TNIAC )/2,
ifelse( DRDINT == 1 & is.na( DR1TNIAC ) == FALSE, DR1TNIAC,
ifelse( DRDINT == 1 & is.na( DR2TNIAC ) == FALSE, DR2TNIAC, NA ) ) ) )%>%
mutate( B6 = ifelse( DRDINT == 2, ( DR1TVB6+DR2TVB6 )/2,
ifelse( DRDINT == 1 & is.na( DR1TVB6 ) == FALSE, DR1TVB6,
ifelse( DRDINT == 1 & is.na( DR2TVB6 ) == FALSE, DR2TVB6, NA ) ) ) )%>%
mutate( SELE = ifelse( DRDINT == 2, ( DR1TSELE+DR2TSELE )/2,
ifelse( DRDINT == 1 & is.na( DR1TSELE ) == FALSE, DR1TSELE,
ifelse( DRDINT == 1 & is.na( DR2TSELE ) == FALSE, DR2TSELE, NA ) ) ) )%>%
mutate( CALC = ifelse( DRDINT == 2, ( DR1TCALC+DR2TCALC )/2,
ifelse( DRDINT == 1 & is.na( DR1TCALC ) == FALSE, DR1TCALC,
ifelse( DRDINT == 1 & is.na( DR2TCALC ) == FALSE, DR2TCALC, NA ) ) ) )%>%
mutate( IRON = ifelse( DRDINT == 2, ( DR1TIRON+DR2TIRON )/2,
ifelse( DRDINT == 1 & is.na( DR1TIRON ) == FALSE, DR1TIRON,
ifelse( DRDINT == 1 & is.na( DR2TIRON ) == FALSE, DR2TIRON, NA ) ) ) )%>%
mutate( SODIUM = ifelse( DRDINT == 2, ( DR1TSODI+DR2TSODI )/2,
ifelse( DRDINT == 1 & is.na( DR1TSODI ) == FALSE, DR1TSODI,
ifelse( DRDINT == 1 & is.na( DR2TSODI ) == FALSE, DR2TSODI, NA ) ) ) )%>%
mutate( `PMUFA:SFA` = ( MFAT+PFAT )/SFAT )%>%
mutate( WTDR4YR = NA )%>%  ##weights for multiple cycles require 4 yr weights for years 99-01
select( SEQN, WTDRD1, WTDR2D, KCAL, PROT, CARB, TFAT, SFAT, MFAT, PFAT, CHOL, FIBE, ALCO, VITC,
ZINC, MAGN, B1, B2, FOLA, B5, B6, SELE, CALC, IRON, SODIUM, WTDR4YR, `PMUFA:SFA` )
#merge nutrient data
colnames( nutr9901 ) <- colnames( nutrdat03 )
nutrall <- rbind( nutr9901, nutrdat03, nutrdat05, nutrdat07, nutrdat09, nutrdat11, nutrdat13, nutrdat15, nutrdat17 )
length( unique( nutrall$SEQN ) )
nrow( nutrall )
nutrall <- nutrall[unique( nutrall$SEQN ), ]
# Diabetes questionnaire
diqdat99 <- nhanes_load_data( 'DIQ', '1999-2000', demographics = FALSE )
diqdat01 <- nhanes_load_data( 'DIQ', '2001-2002', demographics = FALSE )
diqdat03 <- nhanes_load_data( 'DIQ', '2003-2004', demographics = FALSE )
diqdat05 <- nhanes_load_data( 'DIQ', '2005-2006', demographics = FALSE )
diqdat07 <- nhanes_load_data( 'DIQ', '2007-2008', demographics = FALSE )
diqdat09 <- nhanes_load_data( 'DIQ', '2009-2010', demographics = FALSE )
diqdat11 <- nhanes_load_data( 'DIQ', '2011-2012', demographics = FALSE )
diqdat13 <- nhanes_load_data( 'DIQ', '2013-2014', demographics = FALSE )
diqdat15 <- read_xpt( file = 'https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/DIQ_I.XPT' )
diqdat17 <- read_xpt( file = 'https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/DIQ_J.XPT' )
# Kidney conditions questionnaire
kiqdat99 <- nhanes_load_data( 'KIQ', '1999-2000', demographics = FALSE )
kiqdat01 <- nhanes_load_data( 'KIQ_U_B', '2001-2002', demographics = FALSE )
kiqdat03 <- nhanes_load_data( 'KIQ_U_C', '2003-2004', demographics = FALSE )
kiqdat05 <- nhanes_load_data( 'KIQ_U_D', '2005-2006', demographics = FALSE )
kiqdat07 <- nhanes_load_data( 'KIQ_U_E', '2007-2008', demographics = FALSE )
kiqdat09 <- nhanes_load_data( 'KIQ_U_F', '2009-2010', demographics = FALSE )
kiqdat11 <- nhanes_load_data( 'KIQ_U_G', '2011-2012', demographics = FALSE )
kiqdat13 <- nhanes_load_data( 'KIQ_U_H', '2013-2014', demographics = FALSE )
kiqdat15 <- read_xpt( file = 'https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/KIQ_U_I.XPT' )
kiqdat17 <- read_xpt( file = 'https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/KIQ_U_J.XPT' )
diqdat <- rbind( diqdat99[, c( 'SEQN', 'DIQ010', 'DIQ080' )],
diqdat01[, c( 'SEQN', 'DIQ010', 'DIQ080' )],
diqdat03[, c( 'SEQN', 'DIQ010', 'DIQ080' )],
diqdat05[, c( 'SEQN', 'DIQ010', 'DIQ080' )],
diqdat07[, c( 'SEQN', 'DIQ010', 'DIQ080' )],
diqdat09[, c( 'SEQN', 'DIQ010', 'DIQ080' )],
diqdat11[, c( 'SEQN', 'DIQ010', 'DIQ080' )],
diqdat13[, c( 'SEQN', 'DIQ010', 'DIQ080' )],
diqdat15[, c( 'SEQN', 'DIQ010', 'DIQ080' )],
diqdat17[, c( 'SEQN', 'DIQ010', 'DIQ080' )] ) # diabetes and retinopathy
kiqdat99 <- kiqdat99%>%
rename( KIQ022 = KIQ020 )
kiqdat <- rbind( kiqdat99[, c( 'SEQN', 'KIQ022' )],
kiqdat01[, c( 'SEQN', 'KIQ022' )],
kiqdat03[, c( 'SEQN', 'KIQ022' )],
kiqdat05[, c( 'SEQN', 'KIQ022' )],
kiqdat07[, c( 'SEQN', 'KIQ022' )],
kiqdat09[, c( 'SEQN', 'KIQ022' )],
kiqdat11[, c( 'SEQN', 'KIQ022' )],
kiqdat13[, c( 'SEQN', 'KIQ022' )],
kiqdat15[, c( 'SEQN', 'KIQ022' )],
kiqdat17[, c( 'SEQN', 'KIQ022' )] ) #kidney failure
# Cancer data
cadata <- mcqall.bcd[, c( 'SEQN', 'CATYPEA', 'CATYPEB', 'CATYPEC' )] ###fix here
# merge data together
cci1 <- left_join( diqdat, kiqdat, by = 'SEQN' )
cci2 <- left_join( cci1, mcqall, by = 'SEQN' )
cci3 <- cci2%>%
mutate( diab_flag = ifelse( DIQ010 == 1, 1,
ifelse( DIQ010 == 2, 0,
ifelse( DIQ010 == 3, 0, NA ) ) ) )%>%
mutate( retin_flag = ifelse( ( DIQ010 == 2 & is.na( DIQ080 ) == T ), 0,
ifelse( DIQ080 == 1, 2,
ifelse( DIQ080 == 2, 0, NA ) ) ) )%>%
mutate( kidn_flag = ifelse( KIQ022 == 1, 2,
ifelse( KIQ022 == 2, 0, NA ) ) )%>%
mutate( stroke_flag = ifelse( MCQ160F == 1, 1,
ifelse( MCQ160F == 2, 0, NA ) ) )%>%
mutate( chf_flag = ifelse( MCQ160B == 1, 1,
ifelse( MCQ160B == 2, 0, NA ) ) )%>%
mutate( liver_flag = ifelse( MCQ160L == 1, 2,
ifelse( MCQ160L == 2, 0, NA ) ) )%>%
mutate( RA_flag = ifelse( MCQ160A == 1 & MCQ190 == 1, 1,
ifelse( MCQ160A == 1 & MCQ190 ! = 1, 0,
ifelse( MCQ160A == 2, 0, NA ) ) ) )%>%
mutate( CA_flag = ifelse( MCQ220 == 2, 0,
ifelse( MCQ220 == 1 & is.na( CATYPEA ) == F & is.na( CATYPEB ) == T & is.na( CATYPEC ) == T, 2,
ifelse( MCQ220 == 1 & is.na( CATYPEA ) == F & is.na( CATYPEB ) == F & is.na( CATYPEC ) == T, 4,
ifelse( MCQ220 == 1 & is.na( CATYPEA ) == F & is.na( CATYPEB ) == F & is.na( CATYPEC ) == F, 6, NA ) ) ) ) )%>%
mutate( CCI_Score = diab_flag+retin_flag+kidn_flag+stroke_flag+chf_flag+liver_flag+RA_flag+CA_flag )%>%
select( SEQN, CCI_Score )
# merge data together
cci1 <- left_join( diqdat, kiqdat, by = 'SEQN' )
cci2 <- left_join( cci1, mcqall, by = 'SEQN' )
# merge data together and create flag variables
cci_dat <- left_join( diqdat, kiqdat, by = 'SEQN' ) %>%
left_join( ., mcqall, by = 'SEQN' ) %>%
mutate( diab_flag = ifelse( DIQ010 == 1, 1,
ifelse( DIQ010 == 2, 0,
ifelse( DIQ010 == 3, 0, NA ) ) ) )%>%
mutate( retin_flag = ifelse( ( DIQ010 == 2 & is.na( DIQ080 ) == T ), 0,
ifelse( DIQ080 == 1, 2,
ifelse( DIQ080 == 2, 0, NA ) ) ) )%>%
mutate( kidn_flag = ifelse( KIQ022 == 1, 2,
ifelse( KIQ022 == 2, 0, NA ) ) )%>%
mutate( stroke_flag = ifelse( MCQ160F == 1, 1,
ifelse( MCQ160F == 2, 0, NA ) ) )%>%
mutate( chf_flag = ifelse( MCQ160B == 1, 1,
ifelse( MCQ160B == 2, 0, NA ) ) )%>%
mutate( liver_flag = ifelse( MCQ160L == 1, 2,
ifelse( MCQ160L == 2, 0, NA ) ) )%>%
mutate( RA_flag = ifelse( MCQ160A == 1 & MCQ190 == 1, 1,
ifelse( MCQ160A == 1 & MCQ190 != 1, 0,
ifelse( MCQ160A == 2, 0, NA ) ) ) )%>%
mutate( CA_flag = ifelse( MCQ220 == 2, 0,
ifelse( MCQ220 == 1 & is.na( CATYPEA ) == F & is.na( CATYPEB ) == T & is.na( CATYPEC ) == T, 2,
ifelse( MCQ220 == 1 & is.na( CATYPEA ) == F & is.na( CATYPEB ) == F & is.na( CATYPEC ) == T, 4,
ifelse( MCQ220 == 1 & is.na( CATYPEA ) == F & is.na( CATYPEB ) == F & is.na( CATYPEC ) == F, 6, NA ) ) ) ) )%>%
mutate( CCI_Score = diab_flag+retin_flag+kidn_flag+stroke_flag+chf_flag+liver_flag+RA_flag+CA_flag )%>%
select( SEQN, CCI_Score )
PAQdat99 <- nhanes_load_data( 'PAQIAF', '1999-2000', demographics = FALSE )
PAQdat01 <- nhanes_load_data( 'PAQIAF', '2001-2002', demographics = FALSE )
PAQdat03 <- nhanes_load_data( 'PAQIAF', '2003-2004', demographics = FALSE )
PAQdat05 <- nhanes_load_data( 'PAQIAF', '2005-2006', demographics = FALSE )####PAQ Variable
#Change after 2005
PAQdat07 <- nhanes_load_data( 'PAQ', '2007-2008', demographics = FALSE )
PAQdat09 <- nhanes_load_data( 'PAQ', '2009-2010', demographics = FALSE )
PAQdat11 <- nhanes_load_data( 'PAQ', '2011-2012', demographics = FALSE )
PAQdat13 <- nhanes_load_data( 'PAQ', '2013-2014', demographics = FALSE )
PAQdat15 <- read_xpt( file = 'https://wwwn.cdc.gov/Nchs/Nhanes/2015-2016/PAQ_I.XPT' )
PAQdat17 <- read_xpt( file = 'https://wwwn.cdc.gov/Nchs/Nhanes/2017-2018/PAQ_J.XPT' )
PA9905 <- list( PAQdat99, PAQdat01, PAQdat03, PAQdat05 )
PA0717 <- list( PAQdat07, PAQdat09, PAQdat11, PAQdat13, PAQdat15, PAQdat17 )
#for cycles 2007-2017
for( i in 1:length( PA0717 ) ){
PA0717[[i]] <- PA0717[[i]]%>%
mutate( MinutesVig = ifelse( PAD615 %in% c( 7777, 9999 ), NA,
ifelse( PAQ605 == 2, 0, PAD615 ) ) )%>%
mutate( DaysVig = ifelse( PAQ610 %in% c( 77, 99 ), NA,
ifelse( PAQ605 == 2, 0, PAQ610 ) ) )%>%
mutate( MinutesMod = ifelse( PAD630 %in% c( 7777, 9999 ), NA,
ifelse( PAQ620 == 2, 0, PAD630 ) ) )%>%
mutate( DaysMod = ifelse( PAQ625 %in% c( 77, 99 ), NA,
ifelse( PAQ620 == 2, 0, PAQ625 ) ) )%>%
mutate( MinutesBikeWalk = ifelse( PAD645 %in% c( 7777, 9999 ), NA,
ifelse( PAQ635 == 2, 0, PAD645 ) ) )%>%
mutate( DaysBikeWalk = ifelse( PAQ640 %in% c( 77, 99 ), NA,
ifelse( PAQ635 == 2, 0, PAQ640 ) ) )%>%
mutate( MinutesVigRec = ifelse( PAD660 %in% c( 7777, 9999 ), NA,
ifelse( PAQ650 == 2, 0, PAD660 ) ) )%>%
mutate( DaysVigRec = ifelse( PAQ655 %in% c( 77, 99 ), NA,
ifelse( PAQ650 == 2, 0, PAQ655 ) ) )%>%
mutate( MinutesModRec = ifelse( PAD675 %in% c( 7777, 9999 ), NA,
ifelse( PAQ665 == 2, 0, PAD675 ) ) )%>%
mutate( DaysModRec = ifelse( PAQ670 %in% c( 77, 99 ), NA,
ifelse( PAQ665 == 2, 0, PAQ670 ) ) )%>%
mutate( MinutesSedent = ifelse( PAD680 %in% c( 7777, 9999 ), NA, PAD680 ) )%>%
mutate( VigWeeklyMetMin = ( MinutesVig*DaysVig )*8 )%>%
mutate( ModWeeklyMetMin = ( MinutesMod*DaysMod )*4 )%>%
mutate( BikeWalkWeeklyMetMin = ( MinutesBikeWalk*DaysBikeWalk )*4 )%>%
mutate( VigRecWeeklyMetMin = ( MinutesVigRec*DaysVigRec )*8 )%>%
mutate( ModRecWeeklyMetMin = ( MinutesModRec*DaysModRec )*4 )%>%
mutate( WeekMetMin = VigWeeklyMetMin+ModWeeklyMetMin+
BikeWalkWeeklyMetMin+VigRecWeeklyMetMin+ModRecWeeklyMetMin )%>%
select( WeekMetMin, SEQN )
}
###for cycles 1999-2005
for( i in 1:length( PA9905 ) ){
PA9905[[i]] <- PA9905[[i]]%>%
mutate( MetMin30 = PADDURAT*PADMETS*PADTIMES )%>%#met minutes in a month for a single activity
mutate( WeekMetMinInd = MetMin30/4 )%>%#average met minutes in a week fr a single activity
group_by( SEQN )%>%
mutate( WeekMetMin = sum( WeekMetMinInd ) )%>%
select( SEQN, WeekMetMin )%>%
distinct( SEQN, WeekMetMin )
}
## people with no activity in NHANES 99-05 since they are not included in the PAQIAF
PQdat99 <- nhanes_load_data( 'PAQ', '1999-2000', demographics = FALSE )
PQdat01 <- nhanes_load_data( 'PAQ', '2001-2002', demographics = FALSE )
PQdat03 <- nhanes_load_data( 'PAQ', '2003-2004', demographics = FALSE )
PQdat05 <- nhanes_load_data( 'PAQ', '2005-2006', demographics = FALSE )####PAQ Variable
PQ9905 <- list( PQdat99, PQdat01, PQdat03, PQdat05 )
for ( i in 1: length( PQ9905 ) ){
PQ9905[[i]] <- PQ9905[[i]]%>%
filter( ( PAD200 %in% c( 2, 3 ) ) & ( PAD320 %in% c( 2, 3 ) ) & ( PAD440 %in% c( 2, 3 ) ) )%>%
select( SEQN )%>%
mutate( WeekMetMin = 0 ) #give them 0 weekly met minutes
}
merg9905a <- do.call( 'rbind', PA9905 )
merg9905b <- do.call( 'rbind', PQ9905 )
merg9905 <- rbind( merg9905a, merg9905b )
merg0717 <- do.call( 'rbind', PA0717 )
mergall.pa <- rbind( merg9905, merg0717 )
names( demoall )
mcqdemo <- left_join( demoall, mcqall.bcd[, -which( colnames( mcqall.bcd ) == 'RIDAGEYR' )], by = 'SEQN' )
d1 <- left_join( demoall, mcqall.bcd[, -which( colnames( mcqall.bcd ) == 'RIDAGEYR' )], by = 'SEQN' )%>%
left_join( ., smdall[, c( 'SEQN', 'SmokStat' )], by = 'SEQN' ) %>%
left_join( ., alqall[, c( 'SEQN', 'ALCUSE' )], by = 'SEQN' ) %>%
left_join( ., fsdall[, c( 'SEQN', 'FoodSecCatHH', 'FoodSecCatAD', 'FoodAsstP',
'FoodAsstPnowic', 'BinFoodSecHH', 'BinFoodSecAD' )], by = 'SEQN' ) %>%
left_join( ., bmiall, by = "SEQN" ) %>%
left_join( ., nutrall, by = "SEQN" ) %>%
left_join( ., cci_dat, by = "SEQN" ) %>%
left_join( ., mergall.pa, by = "SEQN" )
#####MERGE
# merge with FPED data from previousR script
setwd( '/Volumes/My Passport for Mac/Arthur Lab/FPED Raw Data/Analysis files/GitHub Repository Files /NHANES-Diet-Penalized-Regression/Data-Wrangled' )
#####MERGE
# merge all individual datasets together and then, finally, merge with FPED data from previous R script
setwd( '/Volumes/My Passport for Mac/Arthur Lab/FPED Raw Data/Analysis files/GitHub Repository Files /NHANES-Diet-Penalized-Regression/Data-Wrangled' )
d <- left_join( demoall, mcqall.bcd[, -which( colnames( mcqall.bcd ) == 'RIDAGEYR' )], by = 'SEQN' )%>%
left_join( ., smdall[, c( 'SEQN', 'SmokStat' )], by = 'SEQN' ) %>%
left_join( ., alqall[, c( 'SEQN', 'ALCUSE' )], by = 'SEQN' ) %>%
left_join( ., fsdall[, c( 'SEQN', 'FoodSecCatHH', 'FoodSecCatAD', 'FoodAsstP',
'FoodAsstPnowic', 'BinFoodSecHH', 'BinFoodSecAD' )], by = 'SEQN' ) %>%
left_join( ., bmiall, by = "SEQN" ) %>%
left_join( ., nutrall, by = "SEQN" ) %>%
left_join( ., cci_dat, by = "SEQN" ) %>%
left_join( ., mergall.pa, by = "SEQN" ) %>%
finalstep <- left_join( ., readRDS( '01-FPED-Wrangled.rds' ), by = 'SEQN' )
d <- left_join( demoall, mcqall.bcd[, -which( colnames( mcqall.bcd ) == 'RIDAGEYR' )], by = 'SEQN' )%>%
left_join( ., smdall[, c( 'SEQN', 'SmokStat' )], by = 'SEQN' ) %>%
left_join( ., alqall[, c( 'SEQN', 'ALCUSE' )], by = 'SEQN' ) %>%
left_join( ., fsdall[, c( 'SEQN', 'FoodSecCatHH', 'FoodSecCatAD', 'FoodAsstP',
'FoodAsstPnowic', 'BinFoodSecHH', 'BinFoodSecAD' )], by = 'SEQN' ) %>%
left_join( ., bmiall, by = "SEQN" ) %>%
left_join( ., nutrall, by = "SEQN" ) %>%
left_join( ., cci_dat, by = "SEQN" ) %>%
left_join( ., mergall.pa, by = "SEQN" ) %>%
left_join( ., readRDS( '01-FPED-Wrangled.rds' ), by = 'SEQN' )
#####MERGE
# merge all individual datasets together and then, finally, merge with FPED data from previous R script
setwd( '/Volumes/My Passport for Mac/Arthur Lab/FPED Raw Data/Analysis files/GitHub Repository Files /NHANES-Diet-Penalized-Regression/Data-Wrangled' )
d <- left_join( demoall, mcqall.bcd[, -which( colnames( mcqall.bcd ) == 'RIDAGEYR' )], by = 'SEQN' )%>%
left_join( ., smdall[, c( 'SEQN', 'SmokStat' )], by = 'SEQN' ) %>%
left_join( ., alqall[, c( 'SEQN', 'ALCUSE' )], by = 'SEQN' ) %>%
left_join( ., fsdall[, c( 'SEQN', 'FoodSecCatHH', 'FoodSecCatAD', 'FoodAsstP',
'FoodAsstPnowic', 'BinFoodSecHH', 'BinFoodSecAD' )], by = 'SEQN' ) %>%
left_join( ., bmiall, by = "SEQN" ) %>%
left_join( ., nutrall, by = "SEQN" ) %>%
left_join( ., cci_dat, by = "SEQN" ) %>%
left_join( ., mergall.pa, by = "SEQN" ) %>%
left_join( ., readRDS( '01-FPED-Wrangled.rds' ), by = 'SEQN' ) %>%
# Create 18yr and 16yr weights using 2 days of dietary data ( WTDR2D weights )
#https://wwwn.cdc.gov/Nchs/Nhanes/2003-2004/DR2TOT_C.htm#WTDR2D
mutate( WTDR18YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/10 )*WTDR4YR,  # 1999-2017
ifelse( Cycle %in% c( 3:10 ), ( 8/10 )*WTDR2D, NA ) ),
WTDR16YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/9 )*WTDR4YR,  # 1999-2015
ifelse( Cycle %in% c( 3:9 ), ( 7/9 )*WTDR2D, NA ) ),
WTDR14YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/8 )*WTDR4YR, # 1999-2013
ifelse( Cycle %in% c( 3:8 ), ( 6/8 )*WTDR2D, NA ) ) )
# setting `PMUFA:SFA` in those with zero intake in fat to 0 since dividing
# by zero caused them to show up as NA incorrectly
# make alcohol intake categorical variable using dietary intake data
sapply( finalstep, function( x ) sum( is.na( x ) ) )
# setting `PMUFA:SFA` in those with zero intake in fat to 0 since dividing
# by zero caused them to show up as NA incorrectly
# make alcohol intake categorical variable using dietary intake data
sapply( d, function( x ) sum( is.na( x ) ) )
d <- left_join( demoall, mcqall.bcd[, -which( colnames( mcqall.bcd ) == 'RIDAGEYR' )], by = 'SEQN' )%>%
left_join( ., smdall[, c( 'SEQN', 'SmokStat' )], by = 'SEQN' ) %>%
left_join( ., alqall[, c( 'SEQN', 'ALCUSE' )], by = 'SEQN' ) %>%
left_join( ., fsdall[, c( 'SEQN', 'FoodSecCatHH', 'FoodSecCatAD', 'FoodAsstP',
'FoodAsstPnowic', 'BinFoodSecHH', 'BinFoodSecAD' )], by = 'SEQN' ) %>%
left_join( ., bmiall, by = "SEQN" ) %>%
left_join( ., nutrall, by = "SEQN" ) %>%
left_join( ., cci_dat, by = "SEQN" ) %>%
left_join( ., mergall.pa, by = "SEQN" ) %>%
left_join( ., readRDS( '01-FPED-Wrangled.rds' ), by = 'SEQN' ) %>%
# Create 18yr and 16yr weights using 2 days of dietary data ( WTDR2D weights )
mutate( WTDR18YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/10 )*WTDR4YR,  # 1999-2017
ifelse( Cycle %in% c( 3:10 ), ( 8/10 )*WTDR2D, NA ) ),
WTDR16YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/9 )*WTDR4YR,  # 1999-2015
ifelse( Cycle %in% c( 3:9 ), ( 7/9 )*WTDR2D, NA ) ),
WTDR14YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/8 )*WTDR4YR, # 1999-2013
ifelse( Cycle %in% c( 3:8 ), ( 6/8 )*WTDR2D, NA ) ),
# setting `PMUFA:SFA` in those with zero intake in fat to 0 since dividing
# by zero caused them to show up as NA incorrectly
`PMUFA:SFA` = ifelse( is.na( finalstep$`PMUFA:SFA` ) == TRUE & finalstep$PFAT == 0
& finalstep$MFAT == 0 &finalstep$SFAT == 0, 0, `PMUFA:SFA` ),
# make alcohol intake categorical variable using dietary intake data
alc_cat = factor( ifelse( ALCO<0.1, 'non-drinking',
ifelse( ALCO<28 & ALCO >= 0.1 & Gender == 'Male', 'moderate',
ifelse( ALCO<14 & ALCO >= 0.1 & Gender == 'Female', 'moderate',
ifelse( ALCO>= 28  & Gender == 'Male', 'heavy',
ifelse( ALCO>= 14  & Gender == 'Female', 'heavy', NA ) ) ) ) ) ) )%>%
arrange(Age)
d <- left_join( demoall, mcqall.bcd[, -which( colnames( mcqall.bcd ) == 'RIDAGEYR' )], by = 'SEQN' )%>%
left_join( ., smdall[, c( 'SEQN', 'SmokStat' )], by = 'SEQN' ) %>%
left_join( ., alqall[, c( 'SEQN', 'ALCUSE' )], by = 'SEQN' ) %>%
left_join( ., fsdall[, c( 'SEQN', 'FoodSecCatHH', 'FoodSecCatAD', 'FoodAsstP',
'FoodAsstPnowic', 'BinFoodSecHH', 'BinFoodSecAD' )], by = 'SEQN' ) %>%
left_join( ., bmiall, by = "SEQN" ) %>%
left_join( ., nutrall, by = "SEQN" ) %>%
left_join( ., cci_dat, by = "SEQN" ) %>%
left_join( ., mergall.pa, by = "SEQN" ) %>%
left_join( ., readRDS( '01-FPED-Wrangled.rds' ), by = 'SEQN' ) %>%
# Create 18yr and 16yr weights using 2 days of dietary data ( WTDR2D weights )
mutate( WTDR18YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/10 )*WTDR4YR,  # 1999-2017
ifelse( Cycle %in% c( 3:10 ), ( 8/10 )*WTDR2D, NA ) ),
WTDR16YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/9 )*WTDR4YR,  # 1999-2015
ifelse( Cycle %in% c( 3:9 ), ( 7/9 )*WTDR2D, NA ) ),
WTDR14YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/8 )*WTDR4YR, # 1999-2013
ifelse( Cycle %in% c( 3:8 ), ( 6/8 )*WTDR2D, NA ) ),
# setting `PMUFA:SFA` in those with zero intake in fat to 0 since dividing
# by zero caused them to show up as NA incorrectly
`PMUFA:SFA` = ifelse( is.na( `PMUFA:SFA` ) == TRUE & PFAT == 0
& MFAT == 0 &SFAT == 0, 0, `PMUFA:SFA` ),
# make alcohol intake categorical variable using dietary intake data
alc_cat = factor( ifelse( ALCO<0.1, 'non-drinking',
ifelse( ALCO<28 & ALCO >= 0.1 & Gender == 'Male', 'moderate',
ifelse( ALCO<14 & ALCO >= 0.1 & Gender == 'Female', 'moderate',
ifelse( ALCO>= 28  & Gender == 'Male', 'heavy',
ifelse( ALCO>= 14  & Gender == 'Female', 'heavy', NA ) ) ) ) ) ) )%>%
arrange(Age)
#####MERGE
# merge all individual datasets together and then, finally, merge with FPED data from previous R script
setwd( '/Volumes/My Passport for Mac/Arthur Lab/FPED Raw Data/Analysis files/GitHub Repository Files /NHANES-Diet-Penalized-Regression/Data-Wrangled' )
d <- left_join( demoall, mcqall.bcd[, -which( colnames( mcqall.bcd ) == 'RIDAGEYR' )], by = 'SEQN' )%>%
left_join( ., smdall[, c( 'SEQN', 'SmokStat' )], by = 'SEQN' ) %>%
left_join( ., alqall[, c( 'SEQN', 'ALCUSE' )], by = 'SEQN' ) %>%
left_join( ., fsdall[, c( 'SEQN', 'FoodSecCatHH', 'FoodSecCatAD', 'FoodAsstP',
'FoodAsstPnowic', 'BinFoodSecHH', 'BinFoodSecAD' )], by = 'SEQN' ) %>%
left_join( ., bmiall, by = "SEQN" ) %>%
left_join( ., nutrall, by = "SEQN" ) %>%
left_join( ., cci_dat, by = "SEQN" ) %>%
left_join( ., mergall.pa, by = "SEQN" ) %>%
left_join( ., readRDS( '01-FPED-Wrangled.rds' ), by = 'SEQN' ) %>%
# Create 18yr and 16yr weights using 2 days of dietary data ( WTDR2D weights )
mutate( WTDR18YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/10 )*WTDR4YR,  # 1999-2017
ifelse( Cycle %in% c( 3:10 ), ( 8/10 )*WTDR2D, NA ) ),
WTDR16YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/9 )*WTDR4YR,  # 1999-2015
ifelse( Cycle %in% c( 3:9 ), ( 7/9 )*WTDR2D, NA ) ),
WTDR14YR = ifelse( Cycle %in% c( 1, 2 ), ( 2/8 )*WTDR4YR, # 1999-2013
ifelse( Cycle %in% c( 3:8 ), ( 6/8 )*WTDR2D, NA ) ),
# setting `PMUFA:SFA` in those with zero intake in fat to 0 since dividing
# by zero caused them to show up as NA incorrectly
`PMUFA:SFA` = ifelse( is.na( `PMUFA:SFA` ) == TRUE & PFAT == 0
& MFAT == 0 &SFAT == 0, 0, `PMUFA:SFA` ),
# make alcohol intake categorical variable using dietary intake data
alc_cat = factor( ifelse( ALCO<0.1, 'non-drinking',
ifelse( ALCO<28 & ALCO >= 0.1 & Gender == 'Male', 'moderate',
ifelse( ALCO<14 & ALCO >= 0.1 & Gender == 'Female', 'moderate',
ifelse( ALCO>= 28  & Gender == 'Male', 'heavy',
ifelse( ALCO>= 14  & Gender == 'Female', 'heavy', NA ) ) ) ) ) ),
# Create an indicator variable for cancer and food insecure subjects
CAFS = ifelse( CA == 1 & BinFoodSecHH == 'Low' & Age>= 20, 1,
ifelse( is.na( CA ) == TRUE | is.na( BinFoodSecHH ) == TRUE, NA,
0 ) ) ) %>%
# sort rows by age
arrange(Age)
# Save
setwd( '/Volumes/My Passport for Mac/Arthur Lab/FPED Raw Data/Analysis files/GitHub Repository Files /NHANES-Diet-Penalized-Regression/Data-Wrangled' )
saveRDS( d, '02-Covariates-Wrangled' )
saveRDS( d, '02-Covariates-Wrangled.rds' )
